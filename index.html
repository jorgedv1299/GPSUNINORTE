
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPS UNINORTE</title>
    <style>
        body {
            font-family: Roboto, sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
            background-color: #12025a;
        }

        .container {
            padding: 20px;
            background-color: #097f6a;
            margin: 50px auto;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            max-width: 600px;
            display: none; /* Secciones ocultas por defecto */
        }

        h1 {
            color: #333;
        }

        #map-realtime, #map-route {
            height: 400px;
            width: 100%;
            margin-top: 20px;
        }

        .input-group {
            margin: 10px 0;
        }

        /* Estilo para el contenedor de botones */
        .nav-container {
            background-color: #444;
            padding: 20px;
            display: flex;
            justify-content: center;
            gap: 20px; /* Separación entre los botones */
            margin-top: 20px;
        }

        /* Estilo para los enlaces como botones */
        .nav-container a {
            background-color: white;
            color: #444;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 8px;
            border: 2px solid #444;
            transition: background-color 0.3s;
        }

        .nav-container a:hover {
            background-color: #333;
            color: white;
            cursor: pointer;
        }

        .nav-container a.active {
            background-color: #333;
            color: white;
        }
    </style>
</head>
<body>

    <!-- Contenedor de botones -->
    <div class="nav-container">
        <a href="#realtime" id="nav-realtime">Ver posición en tiempo real</a>
        <a href="#search" id="nav-search">Buscar recorrido</a>
    </div>

    <div class="container" id="realtime-section">
        <h1>GPS<br>Recorrido en tiempo real</h1>

        <div id="location">
            <p><strong>Latitud:</strong> <span id="latitud">Cargando...</span></p>
            <p><strong>Longitud:</strong> <span id="longitud">Cargando...</span></p>
            <p><strong>Timestamp:</strong> <span id="timestamp">Cargando...</span></p>
        </div>

        <!-- Mapa para ver posición en tiempo real -->
        <div id="map-realtime"></div>
    </div>

    <div class="container" id="search-section">
        <h1>Buscar Recorrido</h1>
        
        <div class="input-group">
            <label for="start-date">Fecha y hora inicial:</label>
            <input type="datetime-local" id="start-date">
        </div>

        <div class="input-group">
            <label for="end-date">Fecha y hora final:</label>
            <input type="datetime-local" id="end-date">
        </div>

        <button id="show-route">Mostrar recorrido</button>

        <!-- Mapa para ver recorridos por fecha -->
        <div id="map-route"></div>
    </div>

    <script>
        // Variables para los mapas
        let mapRealTime;
        let markerRealTime;
        let realTimePath = [];
        let realTimePolyline;

        let mapRoute;
        let routePolyline;

        // Inicializar el mapa de tiempo real
        function initMapRealTime() {
            mapRealTime = new google.maps.Map(document.getElementById('map-realtime'), {
                zoom: 15,
                center: { lat: 0, lng: 0 }
            });
            markerRealTime = new google.maps.Marker({
                position: { lat: 0, lng: 0 },
                map: mapRealTime,
                icon: {
                    url: "https://maps.google.com/mapfiles/ms/icons/green-dot.png",
                    scaledSize: new google.maps.Size(30, 30)
                }
            });
            realTimePolyline = new google.maps.Polyline({
                path: realTimePath,
                geodesic: true,
                strokeColor: "#0000FF",
                strokeOpacity: 1.0,
                strokeWeight: 2
            });
            realTimePolyline.setMap(mapRealTime);
        }

        // Inicializar el mapa para buscar recorridos por fecha
        function initMapRoute() {
            mapRoute = new google.maps.Map(document.getElementById('map-route'), {
                zoom: 15,
                center: { lat: 0, lng: 0 }
            });
        }

        // Actualizar la ubicación en tiempo real
        function updateCurrentLocation(lat, lng, timestamp) {
            const position = { lat: lat, lng: lng };
            markerRealTime.setPosition(position);
            realTimePath.push(position);
            realTimePolyline.setPath(realTimePath);
            mapRealTime.setCenter(position);
            document.getElementById('latitud').innerText = lat;
            document.getElementById('longitud').innerText = lng;
            document.getElementById('timestamp').innerText = new Date(timestamp).toLocaleString('es-CO');
        }

        // Mostrar el recorrido entre dos fechas
        function fetchRoute(startDate, endDate) {
            const url = `get_route.php?start=${startDate}&end=${endDate}`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        let path = [];
                        data.forEach(point => {
                            const position = { lat: parseFloat(point.latitud), lng: parseFloat(point.longitud) };
                            path.push(position);
                        });
                        if (routePolyline) {
                            routePolyline.setMap(null);  // Limpiar ruta anterior
                        }
                        routePolyline = new google.maps.Polyline({
                            path: path,
                            geodesic: true,
                            strokeColor: "#FF0000",
                            strokeOpacity: 1.0,
                            strokeWeight: 2
                        });
                        routePolyline.setMap(mapRoute);
                        if (path.length > 0) {
                            mapRoute.setCenter(path[0]);
                        }
                    } else {
                        alert('No se encontraron datos en el rango de fechas seleccionado.');
                    }
                })
                .catch(error => {
                    console.error('Error al obtener el recorrido:', error);
                    alert('Error al obtener el recorrido, revisa la consola para más detalles.');
                });
        }

        document.getElementById('show-route').addEventListener('click', () => {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            if (startDate && endDate) {
                fetchRoute(startDate, endDate);
            } else {
                alert('Por favor selecciona ambas fechas.');
            }
        });

        // Obtener la ubicación actual y actualizar el mapa de tiempo real
        function getCurrentLocation() {
            fetch('get_location.php')
                .then(response => response.json())
                .then(data => {
                    const { latitud, longitud, timestamp } = data;
                    updateCurrentLocation(parseFloat(latitud), parseFloat(longitud), timestamp);
                })
                .catch(error => {
                    console.error('Error al obtener la ubicación actual:', error);
                });
        }

        setInterval(getCurrentLocation, 10000);

        // Mostrar la sección correspondiente y ocultar las demás
        function showSection(sectionId) {
            const sections = document.querySelectorAll('.container');
            sections.forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';
        }

        // Manejo del navbar para cambiar entre secciones
        document.getElementById('nav-realtime').addEventListener('click', () => {
            showSection('realtime-section');
            initMapRealTime(); // Re-inicializar mapa al mostrar la sección
        });

        document.getElementById('nav-search').addEventListener('click', () => {
            showSection('search-section');
            initMapRoute(); // Re-inicializar mapa al mostrar la sección
        });

        // Inicializar la página mostrando la sección de tiempo real por defecto
        window.onload = () => {
            showSection('realtime-section');
            initMapRealTime();
            getCurrentLocation();
        };
    </script>

    <!-- API de Google Maps para ambos mapas -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>
</body>
</html>
